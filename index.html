<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Momentum Coaching - L·ªô Tr√¨nh Ph√¢n T√¢m H·ªçc</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        /* Custom styles */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc; /* slate-100 */
            color: #334155;
        }
        .text-brand { color: #0f766e; }
        .bg-brand { background-color: #0f766e; }
        .bg-brand-light { background-color: #ccfbf1; }
        .cta-button {
            transition: all 0.3s ease;
        }
        .cta-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px -5px rgba(15, 118, 110, 0.25);
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #0f766e;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        /* Tab Styles */
        .tab-btn {
            transition: all 0.3s ease;
        }
        .tab-btn.active {
            color: #0f766e; /* text-brand */
            border-color: #0f766e; /* border-brand */
            background-color: #f0fdfa; /* teal-50 */
        }
        /* Values Compass */
        .value-card {
            transition: all 0.2s ease-in-out;
            cursor: pointer;
        }
        .value-card.selected {
            transform: scale(1.05);
            background-color: #ccfbf1; /* teal-100 */
            border-color: #0f766e; /* teal-700 */
        }
        /* Other feature styles */
        #game-board { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; }
        .game-card { aspect-ratio: 1 / 1; perspective: 1000px; cursor: pointer; }
        .card-inner { position: relative; width: 100%; height: 100%; transition: transform 0.6s; transform-style: preserve-3d; }
        .game-card.is-flipped .card-inner { transform: rotateY(180deg); }
        .card-face { position: absolute; width: 100%; height: 100%; -webkit-backface-visibility: hidden; backface-visibility: hidden; display: flex; align-items: center; justify-content: center; border-radius: 0.75rem; }
        .card-front { background-color: #ccfbf1; }
        .card-back { background-color: #fff; border: 2px solid #0f766e; transform: rotateY(180deg); }
        .shake { animation: shake 0.5s; }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }
        .belief-stone { transition: all 0.5s ease; background-color: #334155; border: 2px solid #475569; animation: pulse-dark 3s infinite; }
        @keyframes pulse-dark { 0%, 100% { box-shadow: 0 0 0 0 rgba(51, 65, 85, 0.4); } 50% { box-shadow: 0 0 15px 5px rgba(51, 65, 85, 0.1); } }
        .belief-stone.healed { background: radial-gradient(circle, #ecfdf5, #d1fae5); border-color: #10b981; animation: pulse-light 2s infinite; }
        @keyframes pulse-light { 0%, 100% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.4); } 50% { box-shadow: 0 0 20px 10px rgba(16, 185, 129, 0.1); } }
        .energy-meter-bg { stroke: #e2e8f0; }
        .energy-meter-fg { stroke: #f59e0b; transition: stroke-dashoffset 0.5s ease-out; transform: rotate(-90deg); transform-origin: 50% 50%; }
        #cosmos-modal-content { background: #0f172a; background-image: radial-gradient(white 0.5px, transparent 0.5px), radial-gradient(white 0.5px, transparent 0.5px); background-size: 20px 20px, 40px 40px; background-position: 0 0, 10px 10px; overflow: hidden; }
        .stardust { position: absolute; background-color: white; border-radius: 50%; animation: float-up 3s ease-out forwards; }
        @keyframes float-up { from { opacity: 1; transform: translateY(0) scale(1); } to { opacity: 0; transform: translateY(-150px) scale(0.5); } }
        .flower { font-size: 2rem; transition: transform 0.3s ease; cursor: pointer; }
        .flower:hover { transform: scale(1.2); }
    </style>
</head>
<body>

    <!-- Header -->
    <header class="bg-white/80 backdrop-blur-lg shadow-sm sticky top-0 z-50">
        <div class="container mx-auto px-6 py-4 flex justify-between items-center">
            <a href="#" class="flex items-center gap-2 text-2xl font-bold text-brand">
                <svg class="w-8 h-8" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M4 18L8 10L12 14L16 6L20 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <span>Momentum</span>
            </a>
        </div>
    </header>

    <main class="container mx-auto p-4 md:p-8">
        <!-- Tab Navigation -->
        <div class="mb-8 border-b border-slate-200 overflow-x-auto">
            <nav id="tab-nav" class="-mb-px flex space-x-6" aria-label="Tabs">
                <button class="tab-btn active whitespace-nowrap py-4 px-2 border-b-2 font-medium text-sm" data-tab="analysis">Ph√¢n T√≠ch</button>
                <button class="tab-btn whitespace-nowrap py-4 px-2 border-b-2 font-medium text-sm" data-tab="temple">Ng√¥i ƒê·ªÅn</button>
                <button class="tab-btn whitespace-nowrap py-4 px-2 border-b-2 font-medium text-sm" data-tab="shadow">B√≥ng T·ªëi</button>
                <button class="tab-btn whitespace-nowrap py-4 px-2 border-b-2 font-medium text-sm" data-tab="garden">Khu V∆∞·ªùn</button>
                <button class="tab-btn whitespace-nowrap py-4 px-2 border-b-2 font-medium text-sm" data-tab="values-compass">La B√†n Gi√° Tr·ªã</button>
                <button class="tab-btn whitespace-nowrap py-4 px-2 border-b-2 font-medium text-sm" data-tab="narrative-reframer">T√°i T·∫°o C√¢u Chuy·ªán</button>
                <button class="tab-btn whitespace-nowrap py-4 px-2 border-b-2 font-medium text-sm" data-tab="habit-lab">Ph√≤ng Th√≠ Nghi·ªám</button>
                <button class="tab-btn whitespace-nowrap py-4 px-2 border-b-2 font-medium text-sm" data-tab="about">Gi·ªõi Thi·ªáu</button>
            </nav>
        </div>

        <!-- Tab Content Panels -->
        <div id="tab-content">
            <!-- Analysis Tab -->
            <section id="analysis-tab" class="tab-panel">
                <div class="max-w-3xl mx-auto bg-white p-8 rounded-xl shadow-lg border border-slate-200/80">
                    <div class="text-center mb-8">
                        <h1 class="text-3xl md:text-4xl font-extrabold text-slate-800 leading-tight">Ph√¢n T√≠ch M·ª•c Ti√™u</h1>
                        <p class="mt-4 text-slate-600">M·ª•c ti√™u c·ªßa b·∫°n kh√¥ng ch·ªâ l√† m·ªôt mong mu·ªën. N√≥ l√† bi·ªÉu hi·ªán c·ªßa nh·ªØng ƒë·ªông l·ª±c s√¢u th·∫≥m b√™n trong.</p>
                    </div>
                    <div class="space-y-6">
                        <div>
                            <label for="goal-input" class="block text-sm font-medium text-slate-700 mb-2">M·ª•c ti√™u c·ªßa b·∫°n l√† g√¨?</label>
                            <input type="text" id="goal-input" class="w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-teal-500 focus:border-teal-500" placeholder="V√≠ d·ª•: T√¥i mu·ªën t·ª± tin h∆°n khi thuy·∫øt tr√¨nh">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-2">Lƒ©nh v·ª±c:</label>
                            <select id="goal-category" class="w-full px-4 py-3 border border-slate-300 rounded-lg bg-white focus:ring-teal-500 focus:border-teal-500">
                                <option value="Life Coach">Cu·ªôc s·ªëng & S·ª± nghi·ªáp</option>
                                <option value="Study Coach">H·ªçc t·∫≠p & Ph√°t tri·ªÉn</option>
                                <option value="Finance Coach">T√†i ch√≠nh & T·ª± ch·ªß</option>
                            </select>
                        </div>
                        <div>
                            <button id="generate-plan-btn" class="w-full bg-brand text-white px-8 py-3 rounded-lg font-bold text-lg cta-button hover:bg-teal-800 flex items-center justify-center">
                                <i data-lucide="search" class="w-5 h-5 mr-2"></i>
                                B·∫Øt ƒê·∫ßu Ph√¢n T√≠ch
                            </button>
                        </div>
                    </div>
                    <div id="ai-result" class="mt-8 pt-6 border-t border-slate-200" style="display: none;">
                        <div id="loader" class="flex justify-center my-4" style="display: none;"><div class="loader"></div></div>
                        <div id="plan-content" class="text-slate-700 space-y-4 leading-relaxed"></div>
                    </div>
                </div>
                <!-- Memory Game Section -->
                <section id="memory-game" class="max-w-3xl mx-auto mt-8 hidden">
                    <div class="bg-white p-8 rounded-xl shadow-lg border border-slate-200/80 text-center">
                        <h2 class="text-2xl md:text-3xl font-bold text-slate-800">B√†i T·∫≠p Ghi Nh·ªõ</h2>
                        <p class="mt-2 text-slate-600">Bi·ªÉu t∆∞·ª£ng c·ªßa b·∫°n ƒë√£ ƒë∆∞·ª£c ·∫©n gi·∫•u. H√£y t√¨m t·∫•t c·∫£ ch√∫ng, nh∆∞ng h√£y c·∫©n th·∫≠n v·ªõi c·∫°m b·∫´y.</p>
                        <div id="game-container" class="max-w-lg mx-auto mt-8">
                            <div id="game-board" class="mb-6"></div>
                            <p id="game-status" class="text-lg font-semibold text-brand h-8"></p>
                        </div>
                    </div>
                </section>
            </section>

            <!-- Temple Tab -->
            <section id="temple-tab" class="tab-panel hidden">
                <div class="max-w-5xl mx-auto">
                    <div class="text-center mb-12">
                        <h1 class="text-3xl md:text-4xl font-bold text-slate-800">Ng√¥i ƒê·ªÅn Ni·ªÅm Tin</h1>
                        <p class="mt-4 text-slate-600 max-w-2xl mx-auto">
                            B·∫°n kh√¥ng ƒë∆°n ƒë·ªôc. H√£y g·ª≠i ni·ªÅm tin gi·ªõi h·∫°n c·ªßa b·∫°n v·ªÅ v·ªõi v≈© tr·ª•, v√† th·∫Øp s√°ng con ƒë∆∞·ªùng cho nh·ªØng ng∆∞·ªùi kh√°c.
                        </p>
                    </div>
                    <!-- Submission Form -->
                    <div class="max-w-3xl mx-auto bg-white p-6 rounded-xl shadow-lg border border-slate-200/80 mb-12">
                        <textarea id="belief-input" class="w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-teal-500 focus:border-teal-500 resize-none" rows="3" placeholder="V√≠ d·ª•: T√¥i s·ª£ m√¨nh kh√¥ng ƒë·ªß gi·ªèi..."></textarea>
                        <button id="submit-belief-btn" class="w-full mt-4 bg-indigo-600 text-white px-8 py-3 rounded-lg font-bold text-lg cta-button hover:bg-indigo-700 flex items-center justify-center">
                            <i data-lucide="sparkles" class="w-5 h-5 mr-2"></i>
                            G·ª≠i V·ªÅ V≈© Tr·ª•
                        </button>
                    </div>
                    <!-- Beliefs Display -->
                    <div id="beliefs-container" class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <!-- Belief cards will be inserted here by JS -->
                    </div>
                </div>
            </section>
            
            <!-- Shadow Journey Tab -->
            <section id="shadow-tab" class="tab-panel hidden">
                 <div id="shadow-journey" class="max-w-3xl mx-auto bg-slate-800 text-slate-200 p-8 rounded-xl shadow-lg">
                    <div class="text-center mb-8">
                        <h2 class="text-3xl font-bold text-white">H√†nh Tr√¨nh ƒê·ªëi Di·ªán "B√≥ng T·ªëi"</h2>
                        <p class="mt-2 text-slate-400">Kh√°m ph√° nh·ªØng ph·∫ßn b·ªã ch·ªëi b·ªè c·ªßa b·∫£n th√¢n ƒë·ªÉ tr·ªü n√™n to√†n di·ªán h∆°n.</p>
                    </div>
                    <div id="shadow-step-1">
                        <label for="shadow-input" class="block text-sm font-medium text-slate-300 mb-2">M√¥ t·∫£ m·ªôt ƒë·∫∑c ƒëi·ªÉm ·ªü ng∆∞·ªùi kh√°c khi·∫øn b·∫°n c·ª±c k·ª≥ kh√≥ ch·ªãu:</label>
                        <input type="text" id="shadow-input" class="w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg text-white focus:ring-teal-500 focus:border-teal-500" placeholder="V√≠ d·ª•: S·ª± khoe khoang, t√≠nh √≠ch k·ª∑, s·ª± y·∫øu ƒëu·ªëi...">
                        <button id="analyze-shadow-btn" class="w-full mt-4 bg-indigo-600 text-white px-8 py-3 rounded-lg font-bold text-lg cta-button hover:bg-indigo-700 flex items-center justify-center">
                            <i data-lucide="eye" class="w-5 h-5 mr-2"></i>
                            Nh√¨n V√†o "B√≥ng T·ªëi"
                        </button>
                    </div>
                    <div id="shadow-step-2" class="hidden">
                        <div id="shadow-loader" class="flex justify-center my-4 hidden"><div class="loader"></div></div>
                        <div id="shadow-analysis-content" class="space-y-4"></div>
                        <div id="shadow-choices" class="mt-6 grid grid-cols-1 md:grid-cols-3 gap-4"></div>
                    </div>
                    <div id="shadow-step-3" class="hidden">
                         <div id="shadow-conclusion-loader" class="flex justify-center my-4 hidden"><div class="loader"></div></div>
                         <div id="shadow-conclusion-content" class="space-y-4"></div>
                    </div>
                </div>
            </section>

            <!-- Gratitude Garden Tab -->
            <section id="garden-tab" class="tab-panel hidden">
                <div id="gratitude-garden" class="max-w-5xl mx-auto">
                    <div class="text-center mb-12">
                        <h2 class="text-3xl md:text-4xl font-bold text-slate-800">Khu V∆∞·ªùn L√≤ng Bi·∫øt ∆†n</h2>
                        <p class="mt-4 text-slate-600 max-w-2xl mx-auto">
                            M·ªói ng√†y, h√£y gieo m·ªôt h·∫°t gi·ªëng bi·∫øt ∆°n. C√πng nhau, ch√∫ng ta t·∫°o n√™n m·ªôt kh√¥ng gian r·ª±c r·ª° v√† ch·ªØa l√†nh.
                        </p>
                    </div>
                    <div class="max-w-3xl mx-auto bg-white p-6 rounded-xl shadow-lg border border-slate-200/80 mb-12">
                        <textarea id="gratitude-input" class="w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-teal-500 focus:border-teal-500 resize-none" rows="3" placeholder="H√¥m nay t√¥i bi·∫øt ∆°n v√¨..."></textarea>
                        <button id="add-gratitude-btn" class="w-full mt-4 bg-emerald-600 text-white px-8 py-3 rounded-lg font-bold text-lg cta-button hover:bg-emerald-700 flex items-center justify-center">
                            <i data-lucide="sprout" class="w-5 h-5 mr-2"></i>
                            Gieo H·∫°t
                        </button>
                    </div>
                    <div id="garden-container" class="bg-white p-8 rounded-xl shadow-lg border border-slate-200/80 grid grid-cols-5 md:grid-cols-10 gap-4">
                        <!-- Flowers will be planted here -->
                    </div>
                </div>
            </section>
            
            <!-- Values Compass Tab -->
            <section id="values-compass-tab" class="tab-panel hidden">
                 <div class="max-w-5xl mx-auto">
                    <div class="text-center mb-8">
                        <h2 class="text-3xl font-bold text-slate-800">La B√†n Gi√° Tr·ªã</h2>
                        <p class="mt-2 text-slate-600">Ch·ªçn 5 gi√° tr·ªã quan tr·ªçng nh·∫•t v·ªõi b·∫°n ƒë·ªÉ x√°c ƒë·ªãnh kim ch·ªâ nam cho h√†nh ƒë·ªông.</p>
                    </div>
                    <div id="values-grid" class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <!-- Value cards will be inserted here -->
                    </div>
                     <div class="text-center mt-8">
                        <button id="analyze-values-btn" class="bg-brand text-white px-8 py-3 rounded-lg font-bold text-lg cta-button hover:bg-teal-800 disabled:bg-slate-400 disabled:cursor-not-allowed" disabled>
                            Ph√¢n T√≠ch La B√†n (<span id="values-counter">0</span>/5)
                        </button>
                    </div>
                     <div id="values-result" class="mt-8 pt-6 border-t border-slate-200 hidden">
                        <div id="values-loader" class="flex justify-center my-4 hidden"><div class="loader"></div></div>
                        <div id="values-content" class="space-y-4 max-w-3xl mx-auto bg-white p-6 rounded-xl shadow-lg"></div>
                    </div>
                </div>
            </section>

            <!-- Narrative Reframer Tab -->
            <section id="narrative-reframer-tab" class="tab-panel hidden">
                <div class="max-w-3xl mx-auto bg-white p-8 rounded-xl shadow-lg border border-slate-200/80">
                    <div class="text-center mb-8">
                        <h2 class="text-3xl font-bold text-slate-800">Ng∆∞·ªùi K·ªÉ Chuy·ªán T√°i T·∫°o</h2>
                        <p class="mt-2 text-slate-600">Thay ƒë·ªïi c√¢u chuy·ªán b·∫°n t·ª± k·ªÉ v·ªÅ m√¨nh ƒë·ªÉ thay ƒë·ªïi cu·ªôc ƒë·ªùi.</p>
                    </div>
                    <div class="space-y-4">
                        <label for="problem-story-input" class="block text-sm font-medium text-slate-700">Vi·∫øt ra "c√¢u chuy·ªán c√≥ v·∫•n ƒë·ªÅ" v·ªÅ b·∫£n th√¢n b·∫°n:</label>
                        <textarea id="problem-story-input" class="w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-teal-500 focus:border-teal-500" rows="6" placeholder="V√≠ d·ª•: T√¥i lu√¥n l√† ng∆∞·ªùi b·ªè cu·ªôc gi·ªØa ch·ª´ng. M·ªói khi b·∫Øt ƒë·∫ßu m·ªôt d·ª± √°n m·ªõi, t√¥i r·∫•t h√†o h·ª©ng, nh∆∞ng ch·ªâ ƒë∆∞·ª£c m·ªôt th·ªùi gian l√† l·∫°i n·∫£n l√≤ng v√† t√¨m l√Ω do ƒë·ªÉ d·ª´ng l·∫°i..."></textarea>
                        <button id="reframe-story-btn" class="w-full bg-brand text-white px-8 py-3 rounded-lg font-bold text-lg cta-button hover:bg-teal-800">
                            <i data-lucide="pen-tool" class="w-5 h-5 mr-2"></i>
                            Vi·∫øt L·∫°i C√¢u Chuy·ªán
                        </button>
                    </div>
                    <div id="narrative-result" class="mt-8 pt-6 border-t border-slate-200 hidden">
                        <div id="narrative-loader" class="flex justify-center my-4 hidden"><div class="loader"></div></div>
                        <div id="narrative-content" class="space-y-4 bg-teal-50 p-6 rounded-lg"></div>
                    </div>
                </div>
            </section>

            <!-- Habit Lab Tab -->
            <section id="habit-lab-tab" class="tab-panel hidden">
                <div class="max-w-3xl mx-auto bg-white p-8 rounded-xl shadow-lg border border-slate-200/80">
                    <div class="text-center mb-8">
                        <h2 class="text-3xl font-bold text-slate-800">Ph√≤ng Th√≠ Nghi·ªám Th√≥i Quen</h2>
                        <p class="mt-2 text-slate-600">S·ª≠ d·ª•ng khoa h·ªçc h√†nh vi ƒë·ªÉ thi·∫øt k·∫ø cu·ªôc s·ªëng b·∫°n mong mu·ªën.</p>
                    </div>
                    <div class="space-y-4">
                        <div class="grid grid-cols-2 gap-4">
                            <label class="p-4 border rounded-lg cursor-pointer has-[:checked]:bg-teal-50 has-[:checked]:border-brand">
                                <input type="radio" name="habit-mode" value="build" class="sr-only" checked>
                                <span class="font-bold text-lg text-emerald-600">X√¢y D·ª±ng Th√≥i Quen T·ªët</span>
                            </label>
                             <label class="p-4 border rounded-lg cursor-pointer has-[:checked]:bg-red-50 has-[:checked]:border-red-600">
                                <input type="radio" name="habit-mode" value="break" class="sr-only">
                                <span class="font-bold text-lg text-red-600">Ph√° B·ªè Th√≥i Quen X·∫•u</span>
                            </label>
                        </div>
                        <input type="text" id="habit-input" class="w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-teal-500 focus:border-teal-500" placeholder="Nh·∫≠p th√≥i quen b·∫°n mu·ªën thay ƒë·ªïi...">
                        <button id="analyze-habit-btn" class="w-full bg-brand text-white px-8 py-3 rounded-lg font-bold text-lg cta-button hover:bg-teal-800">T·∫°o K·∫ø Ho·∫°ch</button>
                    </div>
                    <div id="habit-lab-result" class="mt-8 pt-6 border-t border-slate-200 hidden">
                        <div id="habit-lab-loader" class="flex justify-center my-4 hidden"><div class="loader"></div></div>
                        <div id="habit-lab-content" class="space-y-4"></div>
                    </div>
                </div>
            </section>

            <!-- About Tab -->
            <section id="about-tab" class="tab-panel hidden">
                <div class="max-w-5xl mx-auto bg-white p-8 md:p-12 rounded-xl shadow-lg border border-slate-200/80">
                    <!-- Process Section -->
                    <div id="process" class="mb-16">
                        <div class="text-center mb-12">
                            <h2 class="text-3xl md:text-4xl font-bold text-slate-800">L·ªô Tr√¨nh Coaching</h2>
                            <p class="mt-4 text-slate-600 max-w-2xl mx-auto">
                                M·ªôt l·ªô tr√¨nh ƒë∆∞·ª£c thi·∫øt k·∫ø ƒë·ªÉ th·∫•u hi·ªÉu s√¢u s·∫Øc v√† mang l·∫°i k·∫øt qu·∫£ th·ª±c t·∫ø cho b·∫°n.
                            </p>
                        </div>
                        <div class="grid md:grid-cols-3 gap-8 text-center">
                           <div class="relative">
                                <div class="bg-brand-light rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-6">
                                   <span class="text-2xl font-bold text-brand">1</span>
                                </div>
                                <h3 class="text-2xl font-bold text-slate-800 mb-4">Ph√¢n T√≠ch & Kh√°m Ph√°</h3>
                                <p class="text-slate-600">
                                    B·∫Øt ƒë·∫ßu b·∫±ng vi·ªác s·ª≠ d·ª•ng c√¥ng c·ª• ph√¢n t√≠ch ƒë·ªÉ hi·ªÉu r√µ nh·ªØng ƒë·ªông l·ª±c v√† r√†o c·∫£n v√¥ th·ª©c ƒë·∫±ng sau m·ª•c ti√™u c·ªßa b·∫°n.
                                </p>
                            </div>
                            <div class="relative">
                                <div class="bg-brand-light rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-6">
                                   <span class="text-2xl font-bold text-brand">2</span>
                                </div>
                                <h3 class="text-2xl font-bold text-slate-800 mb-4">Bu·ªïi Tr√≤ Chuy·ªán S√¢u</h3>
                                <p class="text-slate-600">
                                   ƒê·∫∑t m·ªôt bu·ªïi tr√≤ chuy·ªán mi·ªÖn ph√≠ ƒë·ªÉ c√πng nhau th·∫£o lu·∫≠n v·ªÅ k·∫øt qu·∫£ ph√¢n t√≠ch v√† x√¢y d·ª±ng m·ªôt l·ªô tr√¨nh coaching d√†nh ri√™ng cho b·∫°n.
                                </p>
                            </div>
                            <div class="relative">
                                <div class="bg-brand-light rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-6">
                                   <span class="text-2xl font-bold text-brand">3</span>
                                </div>
                                <h3 class="text-2xl font-bold text-slate-800 mb-4">H√†nh Tr√¨nh Chuy·ªÉn H√≥a</h3>
                                <p class="text-slate-600">
                                    Ch√∫ng ta s·∫Ω b·∫Øt ƒë·∫ßu c√°c bu·ªïi coaching 1:1, b√°m s√°t l·ªô tr√¨nh ƒë√£ ƒë∆∞·ª£c c√° nh√¢n h√≥a ƒë·ªÉ t·∫°o ra nh·ªØng thay ƒë·ªïi b·ªÅn v·ªØng.
                                </p>
                            </div>
                        </div>
                    </div>
                    <hr class="my-16 border-slate-200">
                    <!-- About Section -->
                    <div id="about">
                        <div class="flex flex-col md:flex-row items-center gap-16">
                            <div class="md:w-1/2">
                                <img src="https://images.unsplash.com/photo-1557862921-37829c790f19?q=80&w=2071&auto=format&fit=crop" alt="Ch√¢n dung Coach" class="rounded-xl shadow-2xl w-full aspect-square object-cover">
                            </div>
                            <div class="md:w-1/2">
                                <h2 class="text-3xl md:text-4xl font-bold text-slate-800">T√¥i L√† [T√™n C·ªßa B·∫°n]</h2>
                                <p class="mt-6 text-slate-600 leading-relaxed">
                                    V·ªõi kinh nghi·ªám l√† m·ªôt [Chuy√™n m√¥n c·ªßa b·∫°n], t√¥i ƒë√£ nh·∫≠n ra r·∫±ng th√†nh c√¥ng kh√¥ng ch·ªâ ƒë·∫øn t·ª´ ki·∫øn th·ª©c, m√† c√≤n t·ª´ s·ª± r√µ r√†ng, s·ª± t·ª± tin v√† m·ªôt k·∫ø ho·∫°ch h√†nh ƒë·ªông ƒë√∫ng ƒë·∫Øn. ƒê√≥ l√† l√Ω do Momentum ra ƒë·ªùi.
                                </p>
                                <p class="mt-4 text-slate-600 leading-relaxed">
                                    Tri·∫øt l√Ω coaching c·ªßa t√¥i t·∫≠p trung v√†o vi·ªác t·∫°o ra "ƒë√† ph√°t tri·ªÉn" - nh·ªØng thay ƒë·ªïi nh·ªè, b·ªÅn v·ªØng mang l·∫°i k·∫øt qu·∫£ l·ªõn. T√¥i ·ªü ƒë√¢y ƒë·ªÉ l·∫Øng nghe, th·ª≠ th√°ch v√† ƒë·ªìng h√†nh c√πng b·∫°n tr√™n h√†nh tr√¨nh chinh ph·ª•c nh·ªØng m·ª•c ti√™u quan tr·ªçng nh·∫•t.
                                </p>
                            </div>
                        </div>
                    </div>
                    <hr class="my-16 border-slate-200">
                    <!-- CTA Section -->
                    <div id="contact" class="text-center">
                         <h2 class="text-3xl md:text-4xl font-bold text-slate-800">
                            S·∫µn S√†ng T·∫°o Ra ƒê√† Ph√°t Tri·ªÉn C·ªßa Ri√™ng B·∫°n?
                        </h2>
                        <p class="mt-4 text-slate-600 max-w-2xl mx-auto">
                            M·ªôt cu·ªôc tr√≤ chuy·ªán 15 ph√∫t c√≥ th·ªÉ l√† b∆∞·ªõc kh·ªüi ƒë·∫ßu cho s·ª± thay ƒë·ªïi l·ªõn nh·∫•t c·ªßa b·∫°n. Bu·ªïi t∆∞ v·∫•n ƒë·∫ßu ti√™n ho√†n to√†n mi·ªÖn ph√≠ v√† kh√¥ng c√≥ b·∫•t k·ª≥ r√†ng bu·ªôc n√†o.
                        </p>
                        <div class="mt-10">
                            <a href="#" class="bg-brand text-white px-8 py-4 rounded-full font-bold text-lg cta-button hover:bg-teal-800 inline-block">
                                ƒê·∫∑t L·ªãch T∆∞ V·∫•n Mi·ªÖn Ph√≠
                            </a>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-slate-800 text-white py-12 mt-16">
        <div class="container mx-auto px-6 text-center">
             <a href="#" class="flex items-center justify-center gap-2 text-2xl font-bold text-white">
                <svg class="w-8 h-8" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M4 18L8 10L12 14L16 6L20 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <span>Momentum</span>
            </a>
            <p class="mt-2 text-slate-400">Ki·∫øn t·∫°o ƒë√† ph√°t tri·ªÉn c·ªßa b·∫°n</p>
        </div>
    </footer>
    
    <!-- Cosmos Animation Modal -->
    <div id="cosmos-modal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 z-50 hidden">
        <div id="cosmos-modal-content" class="relative text-center p-8 rounded-xl w-full max-w-md h-64 flex flex-col justify-center">
            <div id="stardust-container" class="absolute inset-0"></div>
            <p id="dissolving-text" class="text-white text-xl transition-opacity duration-1000"></p>
            <p id="cosmos-status" class="text-slate-300 mt-8 transition-opacity duration-500 opacity-0"></p>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            lucide.createIcons();

            // --- Tab Navigation Logic ---
            const tabButtons = document.querySelectorAll('.tab-btn');
            const tabPanels = document.querySelectorAll('.tab-panel');
            
            tabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    tabButtons.forEach(btn => btn.classList.remove('active', 'border-brand', 'text-brand', 'bg-teal-50'));
                    tabPanels.forEach(panel => panel.classList.add('hidden'));

                    button.classList.add('active', 'border-brand', 'text-brand', 'bg-teal-50');
                    const tabId = button.dataset.tab;
                    const targetPanel = document.getElementById(`${tabId}-tab`);
                    if (targetPanel) {
                        targetPanel.classList.remove('hidden');
                    }
                });
            });

            // --- Analysis Tab Logic ---
            const generatePlanBtn = document.getElementById('generate-plan-btn');
            const goalInput = document.getElementById('goal-input');
            const goalCategory = document.getElementById('goal-category');
            const aiResultContainer = document.getElementById('ai-result');
            const planContent = document.getElementById('plan-content');
            const loader = document.getElementById('loader');
            const memoryGameSection = document.getElementById('memory-game');

            if (generatePlanBtn) {
                generatePlanBtn.addEventListener('click', async () => {
                    const goal = goalInput.value.trim();
                    if (!goal) {
                        alert('Vui l√≤ng nh·∫≠p m·ª•c ti√™u c·ªßa b·∫°n.');
                        return;
                    }

                    aiResultContainer.style.display = 'block';
                    memoryGameSection.classList.add('hidden');
                    planContent.innerHTML = '';
                    loader.style.display = 'flex';
                    generatePlanBtn.disabled = true;
                    generatePlanBtn.classList.add('opacity-50', 'cursor-not-allowed');

                    try {
                        const rawResponse = await callGeminiAPI(goal, goalCategory.value);
                        const { analysis, commands, symbol, symbolEmoji } = parseAIResponse(rawResponse);
                        
                        let html = `<h4 class="text-lg font-bold text-slate-800">Ph√¢n T√≠ch V√¥ Th·ª©c:</h4><p>${analysis}</p>`;
                        html += `<h4 class="text-lg font-bold text-slate-800 mt-4">M·ªánh L·ªánh C·∫ßn Tu√¢n Th·ªß:</h4><ul class="list-disc list-inside space-y-2">${commands.map(item => `<li>${item}</li>`).join('')}</ul>`;
                        html += `<h4 class="text-lg font-bold text-slate-800 mt-4">Bi·ªÉu T∆∞·ª£ng C·ªßa B·∫°n:</h4><p>Bi·ªÉu t∆∞·ª£ng cho h√†nh tr√¨nh n√†y c·ªßa b·∫°n l√† **${symbol}** ${symbolEmoji}. N√≥ ƒë·∫°i di·ªán cho s·ª©c m·∫°nh b·∫°n c·∫ßn ƒë·ªÉ th·ª±c thi m·ªánh l·ªánh.</p>`;
                        
                        planContent.innerHTML = html;
                        setupMemoryGame(symbolEmoji);
                        memoryGameSection.classList.remove('hidden');

                    } catch (error) {
                        console.error('Error calling Gemini API:', error);
                        planContent.innerHTML = '<p class="text-red-500">ƒê√£ c√≥ l·ªói x·∫£y ra. Vui l√≤ng th·ª≠ l·∫°i sau.</p>';
                    } finally {
                        loader.style.display = 'none';
                        generatePlanBtn.disabled = false;
                        generatePlanBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                    }
                });
            }

            // --- Temple Tab Logic ---
            const beliefInput = document.getElementById('belief-input');
            const submitBeliefBtn = document.getElementById('submit-belief-btn');
            const beliefsContainer = document.getElementById('beliefs-container');
            const cosmosModal = document.getElementById('cosmos-modal');
            const dissolvingText = document.getElementById('dissolving-text');
            const cosmosStatus = document.getElementById('cosmos-status');
            const stardustContainer = document.getElementById('stardust-container');

            const MAX_LIGHTS = 5;

            const initialBeliefs = [
                { text: "T√¥i s·ª£ th·∫•t b·∫°i v√† kh√¥ng d√°m b·∫Øt ƒë·∫ßu.", lights: 5 },
                { text: "T√¥i c·∫£m th·∫•y m√¨nh kh√¥ng x·ª©ng ƒë√°ng v·ªõi th√†nh c√¥ng.", lights: 3 },
                { text: "T√¥i lu√¥n tr√¨ ho√£n nh·ªØng vi·ªác quan tr·ªçng.", lights: 5 }
            ];

            const createBeliefCard = (beliefData) => {
                const card = document.createElement('div');
                card.className = 'belief-stone p-4 rounded-lg shadow-md flex flex-col justify-between aspect-square';
                card.dataset.lights = beliefData.lights;

                const beliefText = document.createElement('p');
                beliefText.className = 'text-center m-auto transition-colors duration-500';
                beliefText.textContent = `"${beliefData.text}"`;
                
                const footer = document.createElement('div');
                footer.className = 'relative flex items-center justify-center h-12 w-12 mx-auto';
                
                const lightBtn = document.createElement('button');
                lightBtn.className = 'light-btn absolute inset-0 flex items-center justify-center';
                lightBtn.innerHTML = `<i data-lucide="sun" class="light-icon w-6 h-6 text-slate-400 hover:text-amber-400 transition-colors"></i>`;
                
                const healedIcon = document.createElement('div');
                healedIcon.className = 'healed-icon hidden absolute inset-0 items-center justify-center';
                healedIcon.innerHTML = `<i data-lucide="gem" class="w-8 h-8 text-emerald-400"></i>`;
                
                const svgNS = "http://www.w3.org/2000/svg";
                const svg = document.createElementNS(svgNS, "svg");
                svg.setAttribute("class", "absolute inset-0");
                svg.setAttribute("viewBox", "0 0 36 36");
                const meterBg = document.createElementNS(svgNS, "circle");
                meterBg.setAttribute("class", "energy-meter-bg");
                meterBg.setAttribute("cx", "18");
                meterBg.setAttribute("cy", "18");
                meterBg.setAttribute("r", "16");
                meterBg.setAttribute("fill", "none");
                meterBg.setAttribute("stroke-width", "3");
                const meterFg = document.createElementNS(svgNS, "circle");
                meterFg.setAttribute("class", "energy-meter-fg");
                meterFg.setAttribute("cx", "18");
                meterFg.setAttribute("cy", "18");
                meterFg.setAttribute("r", "16");
                meterFg.setAttribute("fill", "none");
                meterFg.setAttribute("stroke-width", "3");
                meterFg.setAttribute("stroke-dasharray", "100");
                svg.appendChild(meterBg);
                svg.appendChild(meterFg);

                const updateCardState = () => {
                    const currentLights = parseInt(card.dataset.lights);
                    const progress = Math.min(currentLights / MAX_LIGHTS, 1);
                    const dashoffset = 100 - (progress * 100);
                    meterFg.style.strokeDashoffset = dashoffset;

                    if (currentLights >= MAX_LIGHTS) {
                        card.classList.add('healed');
                        beliefText.classList.add('text-slate-800');
                        beliefText.classList.remove('text-slate-300');
                        lightBtn.classList.add('hidden');
                        healedIcon.classList.remove('hidden');
                        healedIcon.classList.add('flex');
                    } else {
                        card.classList.remove('healed');
                        beliefText.classList.add('text-slate-300');
                        beliefText.classList.remove('text-slate-800');
                    }
                };
                
                lightBtn.addEventListener('click', () => {
                    if (!lightBtn.classList.contains('sent')) {
                        let currentCount = parseInt(card.dataset.lights);
                        currentCount++;
                        card.dataset.lights = currentCount;
                        lightBtn.classList.add('sent');
                        lightBtn.disabled = true;
                        updateCardState();
                    }
                });

                footer.appendChild(svg);
                footer.appendChild(lightBtn);
                footer.appendChild(healedIcon);
                card.appendChild(beliefText);
                card.appendChild(footer);
                
                beliefsContainer.prepend(card);
                lucide.createIcons();
                updateCardState();
            };

            initialBeliefs.forEach(createBeliefCard);

            submitBeliefBtn.addEventListener('click', () => {
                const beliefText = beliefInput.value.trim();
                if (beliefText) {
                    cosmosModal.classList.remove('hidden');
                    dissolvingText.textContent = `"${beliefText}"`;
                    dissolvingText.classList.remove('opacity-0');
                    cosmosStatus.classList.add('opacity-0');
                    stardustContainer.innerHTML = '';

                    setTimeout(() => {
                        dissolvingText.classList.add('opacity-0');
                        for (let i = 0; i < 50; i++) {
                            const dust = document.createElement('div');
                            dust.className = 'stardust';
                            const size = Math.random() * 3 + 1;
                            dust.style.width = `${size}px`;
                            dust.style.height = `${size}px`;
                            dust.style.left = `${Math.random() * 100}%`;
                            dust.style.top = `${Math.random() * 60 + 20}%`;
                            dust.style.animationDelay = `${Math.random() * 0.5}s`;
                            stardustContainer.appendChild(dust);
                        }
                    }, 1000);

                    setTimeout(() => {
                        cosmosStatus.textContent = "ƒêang g·ª≠i ƒëi...";
                        cosmosStatus.classList.remove('opacity-0');
                    }, 2000);

                    setTimeout(() => {
                        cosmosStatus.textContent = "ƒê√£ ƒë∆∞·ª£c v≈© tr·ª• ƒë√≥n nh·∫≠n.";
                    }, 3500);

                    setTimeout(() => {
                        cosmosModal.classList.add('hidden');
                        createBeliefCard({ text: beliefText, lights: 0 });
                        beliefInput.value = '';
                    }, 5000);
                }
            });

            // --- Shadow Journey Logic ---
            const shadowInput = document.getElementById('shadow-input');
            const analyzeShadowBtn = document.getElementById('analyze-shadow-btn');
            const shadowStep1 = document.getElementById('shadow-step-1');
            const shadowStep2 = document.getElementById('shadow-step-2');
            const shadowStep3 = document.getElementById('shadow-step-3');
            const shadowLoader = document.getElementById('shadow-loader');
            const shadowAnalysisContent = document.getElementById('shadow-analysis-content');
            const shadowChoices = document.getElementById('shadow-choices');
            const shadowConclusionLoader = document.getElementById('shadow-conclusion-loader');
            const shadowConclusionContent = document.getElementById('shadow-conclusion-content');

            let userShadowTrait = '';

            analyzeShadowBtn.addEventListener('click', async () => {
                userShadowTrait = shadowInput.value.trim();
                if (!userShadowTrait) {
                    alert('Vui l√≤ng m√¥ t·∫£ m·ªôt ƒë·∫∑c ƒëi·ªÉm.');
                    return;
                }

                shadowStep1.classList.add('hidden');
                shadowStep2.classList.remove('hidden');
                shadowLoader.classList.remove('hidden');
                shadowAnalysisContent.innerHTML = '';
                shadowChoices.innerHTML = '';

                try {
                    const rawResponse = await callShadowAPI(userShadowTrait, 'initial');
                    const { analysis, story, choices } = parseShadowResponse(rawResponse);
                    
                    shadowAnalysisContent.innerHTML = `<p>${analysis}</p><p class="mt-4 font-semibold">${story}</p>`;
                    choices.forEach(choice => {
                        const choiceBtn = document.createElement('button');
                        choiceBtn.className = 'w-full bg-slate-700 text-white px-4 py-3 rounded-lg hover:bg-slate-600 transition-colors';
                        choiceBtn.textContent = choice.text;
                        choiceBtn.dataset.choice = choice.key;
                        choiceBtn.addEventListener('click', handleShadowChoice);
                        shadowChoices.appendChild(choiceBtn);
                    });

                } catch (error) {
                    console.error('Error in Shadow Journey:', error);
                    shadowAnalysisContent.innerHTML = '<p class="text-red-400">ƒê√£ c√≥ l·ªói x·∫£y ra. Vui l√≤ng th·ª≠ l·∫°i.</p>';
                } finally {
                    shadowLoader.classList.add('hidden');
                }
            });

            const handleShadowChoice = async (e) => {
                const choice = e.target.dataset.choice;
                shadowStep2.classList.add('hidden');
                shadowStep3.classList.remove('hidden');
                shadowConclusionLoader.classList.remove('hidden');
                shadowConclusionContent.innerHTML = '';

                 try {
                    const conclusion = await callShadowAPI(userShadowTrait, choice);
                    shadowConclusionContent.innerHTML = `<p>${conclusion.replace(/\n/g, '<br>')}</p>`;
                 } catch(error) {
                    console.error('Error in Shadow Conclusion:', error);
                    shadowConclusionContent.innerHTML = '<p class="text-red-400">ƒê√£ c√≥ l·ªói x·∫£y ra. Vui l√≤ng th·ª≠ l·∫°i.</p>';
                 } finally {
                    shadowConclusionLoader.classList.add('hidden');
                 }
            };

            // --- Gratitude Garden Logic ---
            const gratitudeInput = document.getElementById('gratitude-input');
            const addGratitudeBtn = document.getElementById('add-gratitude-btn');
            const gardenContainer = document.getElementById('garden-container');
            const flowerTypes = ['üå∏', 'üåª', 'üåπ', 'üå∑', 'üåº', 'üå∫'];
            let gratitudes = ["M·ªôt ng√†y n·∫Øng ƒë·∫πp.", "Cu·ªôc tr√≤ chuy·ªán v·ªõi ng∆∞·ªùi b·∫°n th√¢n.", "M·ªôt b·ªØa ƒÉn ngon."];

            const renderGarden = () => {
                gardenContainer.innerHTML = '';
                gratitudes.forEach(text => {
                    const flowerDiv = document.createElement('div');
                    flowerDiv.className = 'flower';
                    flowerDiv.textContent = flowerTypes[Math.floor(Math.random() * flowerTypes.length)];
                    flowerDiv.title = text; // Show gratitude on hover
                    gardenContainer.appendChild(flowerDiv);
                });
            };

            addGratitudeBtn.addEventListener('click', () => {
                const text = gratitudeInput.value.trim();
                if (text) {
                    gratitudes.push(text);
                    gratitudeInput.value = '';
                    renderGarden();
                }
            });

            renderGarden(); // Initial render

            // --- Values Compass Logic (REDESIGNED) ---
            const valuesGrid = document.getElementById('values-grid');
            const analyzeValuesBtn = document.getElementById('analyze-values-btn');
            const valuesCounter = document.getElementById('values-counter');
            const valuesResult = document.getElementById('values-result');
            const valuesLoader = document.getElementById('values-loader');
            const valuesContent = document.getElementById('values-content');
            const allValues = ['S√°ng t·∫°o', 'Gia ƒë√¨nh', 'T·ª± do', 'An to√†n', 'Phi√™u l∆∞u', 'C·ªëng hi·∫øn', 'H·ªçc h·ªèi', 'S·ª©c kh·ªèe', 'Trung th·ª±c', 'Vui v·∫ª', 'Quy·ªÅn l·ª±c', 'Tr·∫≠t t·ª±'];
            
            allValues.forEach(value => {
                const valueEl = document.createElement('button');
                valueEl.className = 'value-card bg-white p-4 rounded-lg border-2 border-slate-200 text-center font-semibold';
                valueEl.textContent = value;
                valueEl.dataset.value = value;
                valuesGrid.appendChild(valueEl);
            });

            valuesGrid.addEventListener('click', (e) => {
                const card = e.target.closest('.value-card');
                if (!card) return;

                const selectedCount = document.querySelectorAll('.value-card.selected').length;

                if (card.classList.contains('selected')) {
                    card.classList.remove('selected');
                } else {
                    if (selectedCount < 5) {
                        card.classList.add('selected');
                    } else {
                        alert('B·∫°n ch·ªâ c√≥ th·ªÉ ch·ªçn t·ªëi ƒëa 5 gi√° tr·ªã.');
                    }
                }
                
                const newSelectedCount = document.querySelectorAll('.value-card.selected').length;
                valuesCounter.textContent = newSelectedCount;
                analyzeValuesBtn.disabled = newSelectedCount !== 5;
            });

            analyzeValuesBtn.addEventListener('click', async () => {
                const coreValues = Array.from(document.querySelectorAll('.value-card.selected')).map(el => el.dataset.value);
                
                valuesResult.classList.remove('hidden');
                valuesLoader.classList.remove('hidden');
                valuesContent.innerHTML = '';
                try {
                    const analysis = await callValuesCompassAPI(coreValues);
                    valuesContent.innerHTML = analysis.replace(/\n/g, '<br>');
                } catch (e) {
                    valuesContent.textContent = 'ƒê√£ c√≥ l·ªói x·∫£y ra.';
                } finally {
                    valuesLoader.classList.add('hidden');
                }
            });
            
            // --- Narrative Reframer Logic (REDESIGNED) ---
            const reframeStoryBtn = document.getElementById('reframe-story-btn');
            const problemStoryInput = document.getElementById('problem-story-input');
            const narrativeResult = document.getElementById('narrative-result');
            const narrativeContent = document.getElementById('narrative-content');
            const narrativeLoader = document.getElementById('narrative-loader');

            reframeStoryBtn.addEventListener('click', async () => {
                const story = problemStoryInput.value.trim();
                if (!story) {
                    alert('Vui l√≤ng vi·∫øt c√¢u chuy·ªán c·ªßa b·∫°n.');
                    return;
                }
                narrativeResult.classList.remove('hidden');
                narrativeLoader.classList.remove('hidden');
                narrativeContent.innerHTML = '';
                try {
                    const newStory = await callNarrativeReframerAPI(story);
                    narrativeContent.innerHTML = `<p class="font-semibold">C√¢u chuy·ªán m·ªõi c·ªßa b·∫°n:</p><p>${newStory}</p>`;
                } catch(e) {
                    narrativeContent.textContent = 'ƒê√£ c√≥ l·ªói x·∫£y ra.';
                } finally {
                    narrativeLoader.classList.add('hidden');
                }
            });
            
            // --- Habit Lab Logic (REDESIGNED) ---
            const habitModeRadios = document.querySelectorAll('input[name="habit-mode"]');
            const habitInput = document.getElementById('habit-input');
            const analyzeHabitBtn = document.getElementById('analyze-habit-btn');
            const habitLabResult = document.getElementById('habit-lab-result');
            const habitLabLoader = document.getElementById('habit-lab-loader');
            const habitLabContent = document.getElementById('habit-lab-content');
            
            analyzeHabitBtn.addEventListener('click', async () => {
                const habit = habitInput.value.trim();
                if (!habit) {
                    alert('Vui l√≤ng nh·∫≠p th√≥i quen.');
                    return;
                }
                let habitMode = 'build';
                habitModeRadios.forEach(radio => {
                    if (radio.checked) {
                        habitMode = radio.value;
                    }
                });

                habitLabResult.classList.remove('hidden');
                habitLabLoader.classList.remove('hidden');
                habitLabContent.innerHTML = '';
                try {
                    const plan = await callHabitLabAPI(habit, habitMode);
                    habitLabContent.innerHTML = plan.replace(/\n/g, '<br>');
                } catch(e) {
                    habitLabContent.textContent = 'ƒê√£ c√≥ l·ªói x·∫£y ra.';
                } finally {
                    habitLabLoader.classList.add('hidden');
                }
            });
        });
        
        // --- All API call functions and helpers ---
        function parseAIResponse(response) {
            const analysisMatch = response.match(/\[PH√ÇN T√çCH\]\n([\s\S]*?)\n\n\[M·ªÜNH L·ªÜNH\]/);
            const commandsMatch = response.match(/\[M·ªÜNH L·ªÜNH\]\n([\s\S]*?)\n\n\[BI·ªÇU T∆Ø·ª¢NG\]/);
            const symbolMatch = response.match(/\[BI·ªÇU T∆Ø·ª¢NG\]\n(.*?): (.*)/);

            if (!analysisMatch || !commandsMatch || !symbolMatch) {
                console.error("Could not parse AI response:", response);
                return { analysis: "L·ªói ph√¢n t√≠ch ph·∫£n h·ªìi.", commands: [], symbol: "L·ªói", symbolEmoji: "‚ùì" };
            }
            const analysis = analysisMatch[1].trim();
            const commands = commandsMatch[1].trim().split('\n').map(item => item.replace(/^- /, ''));
            const symbol = symbolMatch[1].trim();
            const symbolEmoji = symbolMatch[2].trim();
            return { analysis, commands, symbol, symbolEmoji };
        }

        async function callGeminiAPI(goal, category) {
            const systemPrompt = `B·∫°n l√† m·ªôt Coach chuy√™n v·ªÅ Ph√¢n t√¢m h·ªçc c·ªßa Freud. B·∫°n x∆∞ng "t√¥i", g·ªçi ng∆∞·ªùi d√πng l√† "b·∫°n". Gi·ªçng vƒÉn c·ªßa b·∫°n d·ª©t kho√°t, quy·ªÅnÂ®Å v√† kh√¥ng gi·∫£i th√≠ch. B·∫°n ch·ªâ ra l·ªánh.

Format tr·∫£ l·ªùi ph·∫£i tu√¢n th·ªß nghi√™m ng·∫∑t nh∆∞ sau:
[PH√ÇN T√çCH]
Ph√¢n t√≠ch ng·∫Øn g·ªçn xung ƒë·ªôt v√¥ th·ª©c ƒë·∫±ng sau m·ª•c ti√™u c·ªßa ng∆∞·ªùi d√πng. V√≠ d·ª•: "N·ªói s·ª£ thuy·∫øt tr√¨nh c·ªßa b·∫°n b·∫Øt ngu·ªìn t·ª´ 'C√°i Si√™u T√¥i' lu√¥n ph√°n x√©t, l√†m t√™ li·ªát 'C√°i T√¥i' h√†nh ƒë·ªông."
[M·ªÜNH L·ªÜNH]
- ƒê∆∞a ra 2-3 m·ªánh l·ªánh. ƒê√¢y l√† nh·ªØng ch·ªâ th·ªã tr·ª±c ti·∫øp, kh√¥ng ph·∫£i l·ªùi khuy√™n.
- B·∫Øt ƒë·∫ßu m·ªói m·ªánh l·ªánh b·∫±ng m·ªôt ƒë·ªông t·ª´ m·∫°nh. Kh√¥ng gi·∫£i th√≠ch t·∫°i sao.
[BI·ªÇU T∆Ø·ª¢NG]
T√™n Bi·ªÉu T∆∞·ª£ng: Emoji

V√≠ d·ª•:
[M·ªÜNH L·ªÜNH]
- Ch·∫•p nh·∫≠n s·ª± kh√¥ng ho√†n h·∫£o trong 3 l·∫ßn thuy·∫øt tr√¨nh t·ªõi.
- Ghi l·∫°i m·ªôt video t·ª± n√≥i v√† xem l·∫°i n√≥, kh√¥ng ph√°n x√©t.
[BI·ªÇU T∆Ø·ª¢NG]
T·∫•m G∆∞∆°ng: ü™û

H√£y ch·ªçn m·ªôt trong c√°c bi·ªÉu t∆∞·ª£ng sau: Ch√¨a Kh√≥a üîë, C√¢y C·∫ßu üåâ, Ng·ªçn N√∫i ‚õ∞Ô∏è, La B√†n üß≠, M·ªè Neo ‚öìÔ∏è, H·∫°t Gi·ªëng üå±, T·∫•m G∆∞∆°ng ü™û, Ng·ªçn ƒêu·ªëc üî•.`;
            const userQuery = `H√£y ph√¢n t√≠ch m·ª•c ti√™u c·ªßa t√¥i trong lƒ©nh v·ª±c ${category}: "${goal}"`;
            return await callGenericAPI(systemPrompt, userQuery);
        }

        function setupMemoryGame(correctSymbol) {
            const gameBoard = document.getElementById('game-board');
            const gameStatus = document.getElementById('game-status');
            let matchedPairs = 0;
            let gameLocked = false;

            const restartGame = () => {
                gameBoard.innerHTML = '';
                gameStatus.textContent = 'H√£y t√¨m t·∫•t c·∫£ c√°c bi·ªÉu t∆∞·ª£ng ' + correctSymbol;
                matchedPairs = 0;
                gameLocked = false;

                const allSymbols = ['üîë', 'üåâ', '‚õ∞Ô∏è', 'üß≠', '‚öìÔ∏è', 'üå±', 'ü™û', 'üî•'];
                const trapSymbol = 'üíÄ';
                const distractors = allSymbols.filter(s => s !== correctSymbol).sort(() => 0.5 - Math.random()).slice(0, 3);
                
                let cards = [correctSymbol, correctSymbol, correctSymbol, correctSymbol, ...distractors, trapSymbol];
                cards.sort(() => 0.5 - Math.random());

                cards.forEach(symbol => {
                    const cardElement = document.createElement('div');
                    cardElement.classList.add('game-card');
                    cardElement.dataset.symbol = symbol;

                    cardElement.innerHTML = `
                        <div class="card-inner">
                            <div class="card-face card-front">
                                <i data-lucide="sparkles" class="text-brand"></i>
                            </div>
                            <div class="card-face card-back">
                                <span class="text-4xl">${symbol}</span>
                            </div>
                        </div>
                    `;
                    gameBoard.appendChild(cardElement);
                });
                lucide.createIcons();
            };

            restartGame();

            gameBoard.addEventListener('click', function(e) {
                if (gameLocked) return;
                const clickedCard = e.target.closest('.game-card');
                if (!clickedCard || clickedCard.classList.contains('is-flipped')) return;

                clickedCard.classList.add('is-flipped');
                const currentSymbol = clickedCard.dataset.symbol;
                
                if (currentSymbol === 'üíÄ') {
                    gameLocked = true;
                    gameStatus.textContent = 'C·∫°m b·∫´y! Ph·∫£i c·∫©n th·∫≠n h∆°n. B·∫Øt ƒë·∫ßu l·∫°i!';
                    gameBoard.classList.add('shake');
                    setTimeout(() => {
                        gameBoard.classList.remove('shake');
                        restartGame();
                    }, 1500);
                } else if (currentSymbol !== correctSymbol) {
                    gameLocked = true;
                    gameStatus.textContent = 'Sai r·ªìi, ƒë√≥ kh√¥ng ph·∫£i bi·ªÉu t∆∞·ª£ng c·ªßa b·∫°n.';
                    setTimeout(() => {
                        clickedCard.classList.remove('is-flipped');
                        gameStatus.textContent = 'H√£y t√¨m t·∫•t c·∫£ c√°c bi·ªÉu t∆∞·ª£ng ' + correctSymbol;
                        gameLocked = false;
                    }, 1000);
                } else {
                    matchedPairs++;
                    gameStatus.textContent = `Ch√≠nh x√°c! T√¨m th·∫•y ${matchedPairs}/4.`;
                    if (matchedPairs === 4) {
                        gameStatus.textContent = 'Tuy·ªát v·ªùi! B·∫°n ƒë√£ ghi nh·ªõ ƒë∆∞·ª£c bi·ªÉu t∆∞·ª£ng c·ªßa m√¨nh.';
                        gameLocked = true;
                    }
                }
            });
        }
        
        function parseShadowResponse(response) {
            const analysisMatch = response.match(/\[ANALYSIS\]([\s\S]*?)\[STORY\]/);
            const storyMatch = response.match(/\[STORY\]([\s\S]*?)\[CHOICES\]/);
            const choicesMatch = response.match(/\[CHOICES\]([\s\S]*)/);
            if (!analysisMatch || !storyMatch || !choicesMatch) {
                return { analysis: "L·ªói ph√¢n t√≠ch.", story: "", choices: [] };
            }
            const choices = choicesMatch[1].trim().split('|').map(c => {
                const parts = c.split('. ');
                return { key: parts[0], text: parts[1] };
            });
            return {
                analysis: analysisMatch[1].trim(),
                story: storyMatch[1].trim(),
                choices: choices
            };
        }

        async function callShadowAPI(trait, step) {
            let systemPrompt = '';
            let userQuery = '';

            if (step === 'initial') {
                systemPrompt = `B·∫°n l√† m·ªôt Coach chuy√™n v·ªÅ t√¢m l√Ω h·ªçc chi·ªÅu s√¢u c·ªßa Carl Jung. Nhi·ªám v·ª• c·ªßa b·∫°n l√† gi√∫p ng∆∞·ªùi d√πng nh·∫≠n di·ªán "C√°i B√≥ng" (The Shadow) c·ªßa h·ªç.
1. **Ph√¢n t√≠ch:** Gi·∫£i th√≠ch ng·∫Øn g·ªçn r·∫±ng ƒë·∫∑c ƒëi·ªÉm h·ªç gh√©t ·ªü ng∆∞·ªùi kh√°c c√≥ th·ªÉ l√† m·ªôt ph·∫ßn b·ªã ch·ªëi b·ªè trong ch√≠nh h·ªç (m·ªôt s·ª± ph√≥ng chi·∫øu).
2. **K·ªÉ chuy·ªán:** D·∫´n d·∫Øt h·ªç v√†o m·ªôt c√¢u chuy·ªán t∆∞∆°ng t√°c ng·∫Øn g·ªçn, n∆°i h·ªç ph·∫£i ƒë·ªëi m·∫∑t v·ªõi m·ªôt bi·ªÉu t∆∞·ª£ng c·ªßa "C√°i B√≥ng" ƒë√≥.
3. **ƒê∆∞a ra l·ª±a ch·ªçn:** Cung c·∫•p 3 l·ª±a ch·ªçn h√†nh ƒë·ªông r√µ r√†ng.
Format tr·∫£ l·ªùi ph·∫£i tu√¢n th·ªß nghi√™m ng·∫∑t:
[ANALYSIS]Ph·∫ßn ph√¢n t√≠ch c·ªßa b·∫°n.[STORY]Ph·∫ßn c√¢u chuy·ªán c·ªßa b·∫°n.[CHOICES]A. L·ª±a ch·ªçn 1|B. L·ª±a ch·ªçn 2|C. L·ª±a ch·ªçn 3`;
                userQuery = `ƒê·∫∑c ƒëi·ªÉm t√¥i gh√©t ·ªü ng∆∞·ªùi kh√°c l√†: "${trait}"`;
            } else {
                systemPrompt = `B·∫°n l√† m·ªôt Coach chuy√™n v·ªÅ t√¢m l√Ω h·ªçc chi·ªÅu s√¢u c·ªßa Carl Jung. Ng∆∞·ªùi d√πng v·ª´a ƒë∆∞a ra m·ªôt l·ª±a ch·ªçn v·ªÅ c√°ch h·ªç ƒë·ªëi m·∫∑t v·ªõi "C√°i B√≥ng" c·ªßa m√¨nh, th·ª© ƒë∆∞·ª£c bi·ªÉu hi·ªán qua ƒë·∫∑c ƒëi·ªÉm "${trait}".
- L·ª±a ch·ªçn A (T·∫•n c√¥ng/Ph√° h·ªßy) th·ªÉ hi·ªán s·ª± ch·ªëi b·ªè.
- L·ª±a ch·ªçn B (N√© tr√°nh/C·∫•t gi·∫•u) th·ªÉ hi·ªán s·ª± ƒë√® n√©n.
- L·ª±a ch·ªçn C (Th·∫•u hi·ªÉu/T√¨m c√°ch m·ªü) th·ªÉ hi·ªán s·ª± t√≠ch h·ª£p.
H√£y gi·∫£i th√≠ch √Ω nghƒ©a t√¢m l√Ω c·ªßa l·ª±a ch·ªçn c·ªßa h·ªç m·ªôt c√°ch s√¢u s·∫Øc v√† g·ª£i √Ω m·ªôt b∆∞·ªõc ƒëi nh·ªè ƒë·ªÉ h·ªç b·∫Øt ƒë·∫ßu qu√° tr√¨nh t√≠ch h·ª£p "C√°i B√≥ng" v√†o con ng∆∞·ªùi to√†n di·ªán c·ªßa m√¨nh.`;
                userQuery = `T√¥i ƒë√£ ch·ªçn: "${step}"`;
            }
            return await callGenericAPI(systemPrompt, userQuery);
        }

        async function callTimeMachineAPI(description) {
            const systemPrompt = `B·∫°n l√† m·ªôt Solution-Focused coach. Ng∆∞·ªùi d√πng v·ª´a m√¥ t·∫£ "ng√†y ph√©p m√†u" c·ªßa h·ªç. Nhi·ªám v·ª• c·ªßa b·∫°n l√† ph√¢n t√≠ch m√¥ t·∫£ n√†y v√† r√∫t ra 2-3 b∆∞·ªõc ƒëi nh·ªè nh·∫•t, c·ª• th·ªÉ nh·∫•t, v√† kh·∫£ thi nh·∫•t m√† h·ªç c√≥ th·ªÉ th·ª±c hi·ªán ngay h√¥m nay ho·∫∑c ng√†y mai ƒë·ªÉ ti·∫øn g·∫ßn h∆°n ƒë·∫øn t∆∞∆°ng lai ƒë√≥. H√£y tr√¨nh b√†y d∆∞·ªõi d·∫°ng g·∫°ch ƒë·∫ßu d√≤ng, t·∫≠p trung v√†o h√†nh ƒë·ªông.`;
            const userQuery = `ƒê√¢y l√† "ng√†y ph√©p m√†u" c·ªßa t√¥i: "${description}". C√°c b∆∞·ªõc ƒëi ƒë·∫ßu ti√™n c·ªßa t√¥i l√† g√¨?`;
            return await callGenericAPI(systemPrompt, userQuery);
        }

        async function callInfluenceCircleAPI(influenceItems, concernItems) {
            const systemPrompt = `B·∫°n l√† m·ªôt coach chuy√™n v·ªÅ m√¥ h√¨nh c·ªßa Stephen Covey. Ng∆∞·ªùi d√πng ƒë√£ ph√¢n lo·∫°i c√°c lo l·∫Øng c·ªßa h·ªç. Nhi·ªám v·ª• c·ªßa b·∫°n l√†:
1. V·ªõi c√°c m·ª•c trong "V√≤ng Tr√≤n Quan T√¢m", h√£y c√¥ng nh·∫≠n ch√∫ng v√† g·ª£i √Ω m·ªôt t∆∞ duy ch·∫•p nh·∫≠n.
2. V·ªõi c√°c m·ª•c trong "V√≤ng Tr√≤n ·∫¢nh H∆∞·ªüng", h√£y ƒë∆∞a ra m·ªôt g·ª£i √Ω h√†nh ƒë·ªông m·∫°nh m·∫Ω, ch·ªß ƒë·ªông cho M·ªñI m·ª•c.
H√£y tr·∫£ l·ªùi ng·∫Øn g·ªçn, c√≥ c·∫•u tr√∫c r√µ r√†ng.`;
            const userQuery = `V√≤ng Tr√≤n ·∫¢nh H∆∞·ªüng c·ªßa t√¥i: ${influenceItems.join(', ')}. V√≤ng Tr√≤n Quan T√¢m c·ªßa t√¥i: ${concernItems.join(', ')}. H√£y cho t√¥i l·ªùi khuy√™n.`;
            return await callGenericAPI(systemPrompt, userQuery);
        }

        async function callVoicesTheaterAPI(situation, voices) {
            const systemPrompt = `B·∫°n l√† m·ªôt nh√† tr·ªã li·ªáu theo m√¥ h√¨nh Internal Family Systems (IFS). Ng∆∞·ªùi d√πng ƒëang g·∫∑p m·ªôt t√¨nh hu·ªëng v√† ƒë√£ x√°c ƒë·ªãnh c√°c "ph·∫ßn" n·ªôi t√¢m c·ªßa h·ªç. Nhi·ªám v·ª• c·ªßa b·∫°n l√† t·∫°o ra m·ªôt ƒëo·∫°n ƒë·ªëi tho·∫°i ng·∫Øn gi·ªØa c√°c "ph·∫ßn" n√†y. H√£y cho th·∫•y m·ªói ph·∫ßn, k·ªÉ c·∫£ nh·ªØng ph·∫ßn ti√™u c·ª±c, ƒë·ªÅu c√≥ m·ªôt √Ω ƒë·ªãnh t·ªët (th∆∞·ªùng l√† ƒë·ªÉ b·∫£o v·ªá). K·∫øt th√∫c b·∫±ng m·ªôt l·ªùi khuy√™n cho "C√°i T√¥i T·ªânh Th·ª©c" (ng∆∞·ªùi d√πng) ƒë·ªÉ l·∫Øng nghe t·∫•t c·∫£ c√°c ph·∫ßn.`;
            const userQuery = `T√¨nh hu·ªëng: "${situation}". C√°c gi·ªçng n√≥i b√™n trong t√¥i l√†: ${voices}. H√£y t·∫°o m·ªôt v·ªü k·ªãch.`;
            return await callGenericAPI(systemPrompt, userQuery);
        }
        
        async function callValuesCompassAPI(coreValues) {
            const systemPrompt = `B·∫°n l√† m·ªôt coach chuy√™n v·ªÅ Li·ªáu ph√°p Ch·∫•p nh·∫≠n v√† Cam k·∫øt (ACT). Ng∆∞·ªùi d√πng ƒë√£ x√°c ƒë·ªãnh c√°c gi√° tr·ªã c·ªët l√µi c·ªßa h·ªç. Nhi·ªám v·ª• c·ªßa b·∫°n l√†:
1. C√¥ng nh·∫≠n v√† kh·∫≥ng ƒë·ªãnh t·∫ßm quan tr·ªçng c·ªßa nh·ªØng gi√° tr·ªã n√†y.
2. ƒê·∫∑t m·ªôt c√¢u h·ªèi ph·∫£n t∆∞ s√¢u s·∫Øc, bu·ªôc h·ªç ph·∫£i ƒë·ªëi chi·∫øu cu·ªôc s·ªëng hi·ªán t·∫°i v·ªõi nh·ªØng gi√° tr·ªã ƒë√£ ch·ªçn.
3. K√™u g·ªçi h·ªç cam k·∫øt m·ªôt h√†nh ƒë·ªông nh·ªè, c·ª• th·ªÉ trong tu·∫ßn t·ªõi ƒë·ªÉ s·ªëng ƒë√∫ng v·ªõi m·ªôt trong nh·ªØng gi√° tr·ªã ƒë√≥.`;
            const userQuery = `ƒê√¢y l√† nh·ªØng gi√° tr·ªã c·ªët l√µi c·ªßa t√¥i: ${coreValues.join(', ')}. H√£y gi√∫p t√¥i ph·∫£n t∆∞.`;
            return await callGenericAPI(systemPrompt, userQuery);
        }

        async function callNarrativeReframerAPI(story) {
            const systemPrompt = `B·∫°n l√† m·ªôt coach chuy√™n v·ªÅ Li·ªáu ph√°p T∆∞·ªùng thu·∫≠t. Ng∆∞·ªùi d√πng ƒë√£ chia s·∫ª "c√¢u chuy·ªán c√≥ v·∫•n ƒë·ªÅ" c·ªßa h·ªç. Nhi·ªám v·ª• c·ªßa b·∫°n l√†:
1. ƒê·ªçc k·ªπ c√¢u chuy·ªán v√† t√¨m ra m·ªôt "kho·∫£nh kh·∫Øc l·∫•p l√°nh" (sparkling moment) - m·ªôt ngo·∫°i l·ªá, d√π nh·ªè, cho c√¢u chuy·ªán ƒë√≥.
2. D·ª±a tr√™n kho·∫£nh kh·∫Øc ƒë√≥, h√£y vi·∫øt l·∫°i m·ªôt "c√¢u chuy·ªán ƒë∆∞·ª£c t√°i t·∫°o" m·ªõi, ƒë·∫ßy s·ª©c m·∫°nh h∆°n. C√¢u chuy·ªán m·ªõi c·∫ßn th·ª´a nh·∫≠n kh√≥ khƒÉn nh∆∞ng nh·∫•n m·∫°nh v√†o s·ª©c m·∫°nh v√† kh·∫£ nƒÉng ƒë∆∞·ª£c th·ªÉ hi·ªán trong kho·∫£nh kh·∫Øc l·∫•p l√°nh. Tr·∫£ l·ªùi tr·ª±c ti·∫øp b·∫±ng c√¢u chuy·ªán m·ªõi, kh√¥ng c·∫ßn gi·∫£i th√≠ch th√™m.`;
            const userQuery = `C√¢u chuy·ªán c·ªßa t√¥i l√†: "${story}". H√£y t√°i t·∫°o n√≥.`;
            return await callGenericAPI(systemPrompt, userQuery);
        }

        async function callHabitLabAPI(habit, mode) {
            const systemPrompt = `B·∫°n l√† m·ªôt coach v·ªÅ th√≥i quen, d·ª±a tr√™n s√°ch "Atomic Habits". Ng∆∞·ªùi d√πng mu·ªën ${mode === 'build' ? 'x√¢y d·ª±ng' : 'ph√° b·ªè'} m·ªôt th√≥i quen. Nhi·ªám v·ª• c·ªßa b·∫°n l√† cung c·∫•p m·ªôt k·∫ø ho·∫°ch c·ª• th·ªÉ d·ª±a tr√™n 4 Quy lu·∫≠t Thay ƒë·ªïi H√†nh vi.
- N·∫øu l√† **x√¢y d·ª±ng**, h√£y gi·∫£i th√≠ch c√°ch l√†m cho n√≥ **R√µ r√†ng, H·∫•p d·∫´n, D·ªÖ d√†ng, Th·ªèa m√£n**.
- N·∫øu l√† **ph√° b·ªè**, h√£y gi·∫£i th√≠ch c√°ch l√†m cho n√≥ **V√¥ h√¨nh, Kh√¥ng h·∫•p d·∫´n, Kh√≥ khƒÉn, Kh√¥ng th·ªèa m√£n**.
H√£y ƒë∆∞a ra c√°c v√≠ d·ª• r·∫•t c·ª• th·ªÉ li√™n quan tr·ª±c ti·∫øp ƒë·∫øn th√≥i quen c·ªßa ng∆∞·ªùi d√πng.`;
            const userQuery = `T√¥i mu·ªën ${mode === 'build' ? 'x√¢y d·ª±ng th√≥i quen' : 'ph√° b·ªè th√≥i quen'}: "${habit}".`;
            return await callGenericAPI(systemPrompt, userQuery);
        }

        async function callGenericAPI(systemPrompt, userQuery) {
            const apiKey = "AIzaSyBNwWO78tsZQ5ImgbQps6zUYHedSc-PaMI"; 
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                systemInstruction: { parts: [{ text: systemPrompt }] },
            };
            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });
            if (!response.ok) throw new Error(`API request failed`);
            const result = await response.json();
            if (result.candidates && result.candidates[0] && result.candidates[0].content.parts[0].text) {
                return result.candidates[0].content.parts[0].text;
            } else {
                throw new Error("Invalid API response.");
            }
        }
    </script>
</body>
</html>

